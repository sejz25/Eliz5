<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ELI5 ‚Äî Explain Like I'm Five</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Architects+Daughter&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#fffdf7;
  --yellow:#ffd93d;--orange:#ff6b35;--blue:#4ecdc4;--pink:#ff6b9d;--purple:#a855f7;--green:#06d6a0;
  --dark:#1a1a2e;--ink:#2d2d44;--muted:#8888aa;
  --card:#ffffff;--border:#e8e4f0;
  --shadow:0 4px 24px rgba(0,0,0,.08);
  --r:20px;
}

html,body{min-height:100vh;background:var(--bg);font-family:'Nunito',sans-serif;color:var(--ink);overflow-x:hidden}

/* ‚îÄ‚îÄ Playful spotted background ‚îÄ‚îÄ */
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:
    radial-gradient(circle 3px at 8% 12%,rgba(255,217,61,.4) 0%,transparent 100%),
    radial-gradient(circle 2px at 92% 8%,rgba(255,107,53,.3) 0%,transparent 100%),
    radial-gradient(circle 4px at 15% 88%,rgba(78,205,196,.3) 0%,transparent 100%),
    radial-gradient(circle 2px at 85% 75%,rgba(255,107,157,.35) 0%,transparent 100%),
    radial-gradient(circle 3px at 45% 5%,rgba(168,85,247,.25) 0%,transparent 100%),
    radial-gradient(circle 2px at 55% 95%,rgba(6,214,160,.3) 0%,transparent 100%),
    radial-gradient(circle 500px at 20% 30%,rgba(255,217,61,.06) 0%,transparent 70%),
    radial-gradient(circle 400px at 80% 70%,rgba(78,205,196,.07) 0%,transparent 70%),
    radial-gradient(circle 350px at 60% 20%,rgba(255,107,157,.05) 0%,transparent 70%);
}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
#app{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:32px 20px 80px}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
header{text-align:center;margin-bottom:44px;animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both}
.header-badge{
  display:inline-flex;align-items:center;gap:8px;
  padding:7px 16px;border-radius:30px;
  background:var(--yellow);color:var(--dark);
  font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;
  margin-bottom:18px;box-shadow:3px 3px 0 rgba(0,0,0,.12);
}
h1{
  font-family:'Architects Daughter',cursive;
  font-size:clamp(2.4rem,7vw,4rem);
  color:var(--dark);line-height:1.1;margin-bottom:14px;
  text-shadow:3px 3px 0 rgba(255,217,61,.4);
}
h1 .word-eli{color:var(--orange)}
h1 .word-five{color:var(--blue)}
header p{font-size:16px;color:var(--muted);max-width:480px;margin:0 auto;line-height:1.65;font-weight:600}

/* ‚îÄ‚îÄ API Key section ‚îÄ‚îÄ */
#api-section{
  background:var(--card);border:2px dashed var(--border);border-radius:var(--r);
  padding:20px 24px;margin-bottom:24px;
  animation:slideUp .5s .1s cubic-bezier(.4,0,.2,1) both;opacity:0;
}
.api-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.api-label{font-size:12px;font-weight:800;letter-spacing:1px;color:var(--muted);white-space:nowrap}
#api-input{
  flex:1;min-width:200px;padding:10px 16px;
  border:2px solid var(--border);border-radius:30px;
  font-family:'Nunito',sans-serif;font-size:13px;color:var(--ink);
  outline:none;transition:border-color .2s;background:var(--bg);
}
#api-input:focus{border-color:var(--blue)}
.api-note{font-size:11px;color:var(--muted);margin-top:10px;line-height:1.6}
.api-note a{color:var(--purple);font-weight:700;text-decoration:none}
.api-note a:hover{text-decoration:underline}
#api-status{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:700;padding:4px 12px;border-radius:20px;margin-left:8px}
#api-status.set{background:rgba(6,214,160,.15);color:var(--green)}
#api-status.empty{background:rgba(255,107,53,.12);color:var(--orange)}

/* ‚îÄ‚îÄ Mode selector ‚îÄ‚îÄ */
#mode-row{display:flex;gap:10px;margin-bottom:24px;justify-content:center;flex-wrap:wrap;
  animation:slideUp .5s .2s cubic-bezier(.4,0,.2,1) both;opacity:0}
.mode-btn{
  display:flex;align-items:center;gap:8px;
  padding:10px 18px;border-radius:30px;border:2px solid var(--border);
  background:var(--card);cursor:pointer;font-family:'Nunito',sans-serif;
  font-size:13px;font-weight:700;color:var(--muted);transition:all .2s;
  box-shadow:2px 2px 0 rgba(0,0,0,.05);
}
.mode-btn:hover{transform:translateY(-2px);box-shadow:3px 5px 0 rgba(0,0,0,.08)}
.mode-btn.active{border-color:var(--orange);color:var(--orange);background:#fff8f5;
  box-shadow:3px 3px 0 rgba(255,107,53,.2)}
.mode-emoji{font-size:18px}

/* ‚îÄ‚îÄ Main card ‚îÄ‚îÄ */
#main-card{
  background:var(--card);border-radius:var(--r);
  border:2px solid var(--border);
  box-shadow:var(--shadow);overflow:hidden;
  animation:slideUp .5s .3s cubic-bezier(.4,0,.2,1) both;opacity:0;
}

/* Input section */
#input-section{padding:28px}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.section-title{font-size:13px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);display:flex;align-items:center;gap:8px}
.char-count{font-size:11px;color:var(--muted);font-weight:600}

#text-input{
  width:100%;min-height:160px;padding:18px;
  border:2px solid var(--border);border-radius:14px;
  font-family:'Nunito',sans-serif;font-size:15px;line-height:1.7;color:var(--ink);
  resize:vertical;outline:none;transition:border-color .2s;background:var(--bg);
}
#text-input:focus{border-color:var(--blue);background:#fff}
#text-input::placeholder{color:#c4c4d8;font-style:italic}

/* Quick examples */
#examples{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.ex-btn{
  padding:6px 14px;border-radius:20px;border:2px solid var(--border);
  background:var(--bg);font-family:'Nunito',sans-serif;font-size:12px;
  font-weight:700;color:var(--muted);cursor:pointer;transition:all .2s;
}
.ex-btn:hover{border-color:var(--purple);color:var(--purple);background:#faf7ff;transform:translateY(-1px)}

/* Divider */
#card-divider{height:2px;background:linear-gradient(90deg,var(--yellow),var(--orange),var(--pink),var(--blue),var(--green));opacity:.4}

/* Age selector */
#age-section{padding:20px 28px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;
  background:rgba(255,217,61,.06);border-bottom:2px solid var(--border)}
.age-label{font-size:13px;font-weight:800;color:var(--ink);white-space:nowrap}
.age-pills{display:flex;gap:8px;flex-wrap:wrap}
.age-pill{
  padding:7px 16px;border-radius:30px;border:2px solid var(--border);
  background:var(--card);cursor:pointer;font-family:'Nunito',sans-serif;
  font-size:13px;font-weight:700;color:var(--muted);transition:all .2s;
}
.age-pill:hover{transform:scale(1.05)}
.age-pill.active{border-color:var(--yellow);background:var(--yellow);color:var(--dark);
  box-shadow:2px 2px 0 rgba(0,0,0,.1)}

/* Generate button */
#btn-section{padding:20px 28px}
#gen-btn{
  width:100%;padding:18px;border:none;border-radius:14px;cursor:pointer;
  background:linear-gradient(135deg,var(--orange),var(--pink));
  color:#fff;font-family:'Nunito',sans-serif;font-size:17px;font-weight:900;
  letter-spacing:.5px;transition:all .25s;position:relative;overflow:hidden;
  box-shadow:0 4px 0 rgba(255,107,53,.35),0 6px 20px rgba(255,107,53,.25);
}
#gen-btn:hover{transform:translateY(-3px);box-shadow:0 7px 0 rgba(255,107,53,.35),0 10px 28px rgba(255,107,53,.3)}
#gen-btn:active{transform:translateY(0);box-shadow:0 1px 0 rgba(255,107,53,.35)}
#gen-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}
.btn-inner{display:flex;align-items:center;justify-content:center;gap:10px}
.btn-emoji{font-size:22px;animation:wiggle 2s infinite}

/* ‚îÄ‚îÄ Output section ‚îÄ‚îÄ */
#output{display:none;animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both}
#output.show{display:block}

#output-card{
  background:var(--card);border-radius:var(--r);
  border:3px solid var(--yellow);
  box-shadow:6px 6px 0 rgba(255,217,61,.3),var(--shadow);
  overflow:hidden;margin-top:24px;
}

/* Output header */
#output-header{
  background:linear-gradient(135deg,var(--yellow),#ffeb8a);
  padding:16px 24px;display:flex;align-items:center;justify-content:space-between;
}
.output-title{display:flex;align-items:center;gap:10px;font-size:14px;font-weight:900;color:var(--dark)}
.output-badge{padding:4px 12px;border-radius:20px;background:rgba(0,0,0,.1);font-size:11px;font-weight:800;letter-spacing:1px}

/* Output body */
#output-body{padding:28px}
#output-text{
  font-size:18px;line-height:1.8;color:var(--ink);font-weight:600;
  font-family:'Nunito',sans-serif;
}
#output-text .highlight{
  background:linear-gradient(180deg,transparent 55%,rgba(255,217,61,.5) 55%);
  border-radius:2px;padding:0 2px;
}

/* Analogy box */
#analogy-box{
  margin-top:20px;padding:18px 20px;
  background:linear-gradient(135deg,rgba(78,205,196,.1),rgba(78,205,196,.05));
  border:2px solid rgba(78,205,196,.3);border-radius:14px;
  display:none;
}
#analogy-box.show{display:block}
.analogy-title{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--blue);margin-bottom:8px;text-transform:uppercase}
#analogy-text{font-size:15px;color:var(--ink);line-height:1.7;font-weight:600}

/* Vocab box */
#vocab-box{margin-top:16px;display:none}
#vocab-box.show{display:block}
.vocab-title{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--purple);margin-bottom:10px;text-transform:uppercase}
#vocab-list{display:flex;flex-direction:column;gap:8px}
.vocab-item{display:flex;gap:10px;align-items:flex-start;padding:10px 14px;
  background:rgba(168,85,247,.06);border:2px solid rgba(168,85,247,.15);
  border-radius:10px}
.vocab-word{font-size:13px;font-weight:900;color:var(--purple);min-width:100px;flex-shrink:0}
.vocab-def{font-size:13px;color:var(--ink);line-height:1.5;font-weight:600}

/* Action bar */
#action-bar{
  padding:16px 24px;background:var(--bg);
  border-top:2px solid var(--border);
  display:flex;gap:10px;flex-wrap:wrap;
}
.action-btn{
  display:flex;align-items:center;gap:7px;
  padding:9px 18px;border-radius:30px;border:2px solid var(--border);
  background:var(--card);cursor:pointer;font-family:'Nunito',sans-serif;
  font-size:13px;font-weight:700;color:var(--muted);transition:all .2s;
}
.action-btn:hover{transform:translateY(-2px);box-shadow:2px 4px 0 rgba(0,0,0,.08)}
.action-btn.teal:hover{border-color:var(--blue);color:var(--blue)}
.action-btn.purple:hover{border-color:var(--purple);color:var(--purple)}
.action-btn.green:hover{border-color:var(--green);color:var(--green)}

/* ‚îÄ‚îÄ Complexity meter ‚îÄ‚îÄ */
#complexity-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:20px}
.meter-card{padding:14px 16px;border-radius:12px;border:2px solid var(--border);background:var(--bg)}
.meter-label{font-size:10px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.meter-track{height:8px;background:rgba(0,0,0,.06);border-radius:4px;overflow:hidden}
.meter-fill{height:100%;border-radius:4px;transition:width 1s cubic-bezier(.4,0,.2,1)}
.meter-val{font-size:12px;font-weight:800;margin-top:6px}

/* ‚îÄ‚îÄ Loading state ‚îÄ‚îÄ */
#loading{display:none;padding:40px;text-align:center}
#loading.show{display:block}
.loading-kid{font-size:60px;animation:bounce 0.6s infinite alternate}
.loading-text{font-family:'Architects Daughter',cursive;font-size:20px;color:var(--orange);margin-top:12px}
.loading-dots span{animation:dotBlink .8s infinite}
.loading-dots span:nth-child(2){animation-delay:.15s}
.loading-dots span:nth-child(3){animation-delay:.3s}

/* ‚îÄ‚îÄ History ‚îÄ‚îÄ */
#history-section{margin-top:28px;display:none;animation:slideUp .4s ease both}
#history-section.show{display:block}
.history-title{font-size:12px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:12px;display:flex;align-items:center;gap:8px}
#history-list{display:flex;flex-direction:column;gap:10px}
.history-item{padding:14px 18px;background:var(--card);border:2px solid var(--border);border-radius:14px;
  cursor:pointer;transition:all .2s}
.history-item:hover{border-color:var(--orange);transform:translateX(4px)}
.hist-topic{font-size:13px;font-weight:800;color:var(--ink);margin-bottom:4px}
.hist-preview{font-size:12px;color:var(--muted);line-height:1.5;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.hist-meta{display:flex;gap:8px;margin-top:8px}
.hist-tag{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:800}

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes popIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes wiggle{0%,100%{transform:rotate(0)}25%{transform:rotate(-10deg)}75%{transform:rotate(10deg)}}
@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-12px)}}
@keyframes dotBlink{0%,80%,100%{opacity:.2}40%{opacity:1}}
@keyframes typewriter{from{width:0}to{width:100%}}

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media(max-width:600px){
  #complexity-row{grid-template-columns:1fr}
  #age-section{flex-direction:column;align-items:flex-start}
  #action-bar{gap:8px}
  .action-btn{font-size:12px;padding:8px 14px}
  h1{font-size:2.2rem}
}
</style>
</head>
<body>
<div id="app">

  <!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ -->
  <header>
    <div class="header-badge">‚ú® AI-Powered Simplifier</div>
    <h1>
      <span class="word-eli">ELI5</span> ‚Äî Explain Like<br>I'm <span class="word-five">Five!</span>
    </h1>
    <p>Paste any confusing science, legal, or tech text and watch the AI magically turn it into something even a 5-year-old gets üéâ</p>
  </header>

  <!-- ‚îÄ‚îÄ API KEY ‚îÄ‚îÄ -->
  <div id="api-section">
    <div class="api-row">
      <span class="api-label">üîë API KEY</span>
      <input type="password" id="api-input" placeholder="sk-ant-api03-‚Ä¶  (paste your Claude API key here)" oninput="checkApiKey()"/>
      <span id="api-status" class="empty">‚óè Not set</span>
    </div>
    <div class="api-note">
      Get your free API key at <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> ‚Üí
      Your key stays in your browser only ‚Äî never sent anywhere except directly to Claude.
      <br/>No key? Use the <strong>Demo Mode</strong> below ‚Äî it works with built-in examples!
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MODE SELECTOR ‚îÄ‚îÄ -->
  <div id="mode-row">
    <button class="mode-btn active" data-mode="science" onclick="setMode('science',this)">
      <span class="mode-emoji">üî¨</span> Science
    </button>
    <button class="mode-btn" data-mode="legal" onclick="setMode('legal',this)">
      <span class="mode-emoji">‚öñÔ∏è</span> Legal
    </button>
    <button class="mode-btn" data-mode="tech" onclick="setMode('tech',this)">
      <span class="mode-emoji">üíª</span> Tech
    </button>
    <button class="mode-btn" data-mode="medical" onclick="setMode('medical',this)">
      <span class="mode-emoji">üè•</span> Medical
    </button>
    <button class="mode-btn" data-mode="finance" onclick="setMode('finance',this)">
      <span class="mode-emoji">üí∞</span> Finance
    </button>
    <button class="mode-btn" data-mode="any" onclick="setMode('any',this)">
      <span class="mode-emoji">üåà</span> Anything!
    </button>
  </div>

  <!-- ‚îÄ‚îÄ MAIN CARD ‚îÄ‚îÄ -->
  <div id="main-card">
    <div id="input-section">
      <div class="section-header">
        <div class="section-title">üìã Paste Your Confusing Text Here</div>
        <span class="char-count" id="char-count">0 / 2000</span>
      </div>
      <textarea id="text-input" placeholder="Paste any complicated paragraph here‚Ä¶

Example: 'Photosynthesis is a process used by plants and other organisms to convert light energy into chemical energy that, through cellular respiration, can later be released to fuel the organism's activities.'"
        maxlength="2000" oninput="updateCharCount()"></textarea>

      <div id="examples">
        <span style="font-size:12px;font-weight:700;color:var(--muted);align-self:center">Try:</span>
      </div>
    </div>

    <div id="card-divider"></div>

    <div id="age-section">
      <span class="age-label">üë¶ Explain it for a‚Ä¶</span>
      <div class="age-pills">
        <button class="age-pill active" data-age="5" onclick="setAge(5,this)">5 yr old üßí</button>
        <button class="age-pill" data-age="8" onclick="setAge(8,this)">8 yr old üë¶</button>
        <button class="age-pill" data-age="12" onclick="setAge(12,this)">12 yr old üßë</button>
        <button class="age-pill" data-age="teenager" onclick="setAge('teenager',this)">Teenager üòé</button>
        <button class="age-pill" data-age="grandparent" onclick="setAge('grandparent',this)">Grandparent üë¥</button>
      </div>
    </div>

    <div id="btn-section">
      <button id="gen-btn" onclick="simplify()">
        <div class="btn-inner">
          <span class="btn-emoji">üß†</span>
          <span id="btn-text">Make It Simple!</span>
        </div>
      </button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ -->
  <div id="loading">
    <div class="loading-kid" id="loading-kid">ü§î</div>
    <div class="loading-text">Thinking really hard<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></div>
  </div>

  <!-- ‚îÄ‚îÄ OUTPUT ‚îÄ‚îÄ -->
  <div id="output">
    <div id="output-card">
      <div id="output-header">
        <div class="output-title">
          <span style="font-size:22px">üéâ</span>
          <span>Here's your simple explanation!</span>
        </div>
        <span class="output-badge" id="output-badge">ELI5</span>
      </div>
      <div id="output-body">
        <div id="output-text"></div>
        <div id="analogy-box">
          <div class="analogy-title">üéØ Fun Analogy</div>
          <div id="analogy-text"></div>
        </div>
        <div id="vocab-box">
          <div class="vocab-title">üìö Big Words Explained</div>
          <div id="vocab-list"></div>
        </div>
        <div id="complexity-row">
          <div class="meter-card">
            <div class="meter-label">Original Complexity</div>
            <div class="meter-track"><div class="meter-fill" id="orig-fill" style="background:linear-gradient(90deg,var(--orange),var(--pink))"></div></div>
            <div class="meter-val" id="orig-val" style="color:var(--orange)"></div>
          </div>
          <div class="meter-card">
            <div class="meter-label">Simplified Readability</div>
            <div class="meter-track"><div class="meter-fill" id="simp-fill" style="background:linear-gradient(90deg,var(--blue),var(--green))"></div></div>
            <div class="meter-val" id="simp-val" style="color:var(--blue)"></div>
          </div>
        </div>
      </div>
      <div id="action-bar">
        <button class="action-btn teal" onclick="copyOutput()">üìã Copy</button>
        <button class="action-btn purple" onclick="readAloud()">üîä Read Aloud</button>
        <button class="action-btn green" onclick="simplifyMore()">üîÑ Simplify Even More!</button>
        <button class="action-btn" onclick="resetAll()" style="margin-left:auto">‚úï Clear</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ -->
  <div id="history-section">
    <div class="history-title">üïê Recent Explanations <span style="font-size:11px;font-weight:600;color:var(--muted)">(this session)</span></div>
    <div id="history-list"></div>
  </div>

</div><!-- end app -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selectedMode = 'science';
let selectedAge  = 5;
let history      = [];
let lastOutput   = '';
let simplifyLevel= 1; // increases on "simplify more"

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXAMPLES PER MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EXAMPLES = {
  science:[
    {label:'üåø Photosynthesis', text:'Photosynthesis is a process by which plants, algae, and some bacteria convert light energy, usually from the sun, into chemical energy stored in glucose. This process occurs in the chloroplasts, using chlorophyll to absorb light, which drives the conversion of carbon dioxide and water into glucose and oxygen.'},
    {label:'‚öõÔ∏è Quantum Physics', text:'Quantum entanglement is a phenomenon where two or more particles become correlated in such a way that the quantum state of one particle cannot be described independently of the others, even when separated by large distances. Measuring one particle instantly influences the state of the entangled partner.'},
    {label:'üß¨ DNA', text:'Deoxyribonucleic acid (DNA) is a molecule composed of two polynucleotide chains that coil around each other to form a double helix. It carries genetic instructions for the development, functioning, growth and reproduction of all known organisms and many viruses.'},
  ],
  legal:[
    {label:'üìú Terms of Service', text:'Notwithstanding any other provision of this Agreement, Company reserves the right, at its sole and absolute discretion, to modify, discontinue, or terminate the Service, or to modify this Agreement, at any time and without prior notice. Continued use of the Service following any such changes shall constitute your consent to such changes.'},
    {label:'üè† Property Law', text:'The doctrine of adverse possession provides that a person who possesses the land of another for a statutorily prescribed period of time may acquire valid title to it, provided the possession is actual, open, notorious, exclusive, hostile, and continuous for the statutory period.'},
    {label:'üìã Contract Clause', text:'In consideration of the mutual covenants and agreements herein contained, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the parties hereby agree to indemnify, defend, and hold harmless each other from and against any and all claims, damages, losses, costs, and expenses.'},
  ],
  tech:[
    {label:'üåê How Internet Works', text:'The Internet Protocol Suite is the conceptual model and set of communications protocols used in the Internet and similar computer networks. It is commonly known as TCP/IP. The foundational protocols in the suite are the Transmission Control Protocol (TCP) and the Internet Protocol (IP), as well as the User Datagram Protocol (UDP).'},
    {label:'ü§ñ Machine Learning', text:'Machine learning is a subset of artificial intelligence that provides systems the ability to automatically learn and improve from experience without being explicitly programmed. It focuses on the development of computer programs that can access data and use it to learn for themselves through pattern recognition.'},
    {label:'üîê Blockchain', text:'A blockchain is a distributed ledger with growing lists of records (blocks) that are securely linked together via cryptographic hashes. Each block contains a cryptographic hash of the previous block, a timestamp, and transaction data, making the records resistant to modification by design.'},
  ],
  medical:[
    {label:'üíä Pharmacokinetics', text:'Pharmacokinetics describes the movement of a drug into, through, and out of the body ‚Äî the time course of its absorption, bioavailability, tissue distribution, metabolism, and excretion. These parameters influence the drug\'s therapeutic efficacy and are critical for determining appropriate dosing regimens.'},
    {label:'üß† Neuroplasticity', text:'Neuroplasticity, also known as neural plasticity or brain plasticity, is the ability of neural networks in the brain to change through growth and reorganization. These changes range from individual neuron pathways making new connections, to systematic adjustments like cortical remapping.'},
    {label:'‚ù§Ô∏è Cardiovascular', text:'Atherosclerosis is a disease in which plaque builds up inside arteries. Plaque is made up of fat, cholesterol, calcium, and other substances found in the blood. Over time, plaque hardens and narrows arteries, limiting the flow of oxygen-rich blood to organs and other parts of the body.'},
  ],
  finance:[
    {label:'üìà Compound Interest', text:'Compound interest is calculated on the initial principal and also on the accumulated interest of previous periods of a deposit or loan. It can be thought of as "interest on interest" and will make a sum grow at a faster rate than simple interest, which is calculated only on the principal amount.'},
    {label:'üíπ Derivatives', text:'A derivative is a financial contract whose value is derived from an underlying asset, index, or rate. Common derivatives include futures, options, swaps, and forwards. Derivatives can be used for hedging, speculation, or arbitrage, and are traded on exchanges or over the counter.'},
    {label:'üè¶ Quantitative Easing', text:'Quantitative easing (QE) is a monetary policy whereby a central bank purchases government securities or other securities from the market in order to increase the money supply and encourage lending and investment. When short-term interest rates are at or approaching zero, quantitative easing is implemented to stimulate the economy.'},
  ],
  any:[
    {label:'üåç Climate Change', text:'Anthropogenic climate change refers to the alteration of the Earth\'s climate system caused by human activities that increase atmospheric concentrations of greenhouse gases, leading to radiative forcing, global temperature increases, and associated changes in precipitation patterns, sea levels, and extreme weather events.'},
    {label:'üé≠ Philosophy', text:'Epistemological relativism is the philosophical position that the truth or justification of beliefs is not absolute, but relative to particular frameworks, contexts, or perspectives. It holds that what is considered true, justified, or rational can vary across different social groups, cultures, or historical periods.'},
    {label:'üåå Cosmology', text:'The observable universe is a spherical region of the universe comprising all matter that can be observed from Earth at the present time, because electromagnetic radiation from these objects has had time to reach Earth since the beginning of the cosmological expansion. There are approximately 2 trillion galaxies in the observable universe.'},
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DEMO RESPONSES (used when no API key)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEMO_RESPONSES = {
  science:{
    explanation:"Okay so! üå± Plants are like little factories that eat sunlight for lunch! They take in water from the ground (like drinking through a straw) and air from outside, and then use sunshine to mix them together and make their own food ‚Äî like sugar! And the best part? While they make their food, they also make the fresh air we breathe! So every time you breathe in, you can say thank you to a plant! üåø",
    analogy:"It's like if you could make a sandwich just by standing in the sun! The plant uses sunlight like we use our hands ‚Äî to put everything together.",
    vocab:[{word:"Chlorophyll",def:"The green stuff inside plant leaves that catches sunlight, like a tiny solar panel!"},{word:"Glucose",def:"The yummy sugar that plants make for themselves as food!"},{word:"Photosynthesis",def:"The whole process of plants making food from sunlight ‚Äî 'photo' means light, 'synthesis' means making!"}],
    origComplexity:88,simpReadability:96
  },
  legal:{
    explanation:"Okay so! ‚öñÔ∏è This paper is basically saying: 'The company can change the rules whenever they want, and if you keep using their stuff after they change the rules, it means you said OK to the new rules ‚Äî even if nobody told you!' It's like if a playground said 'our rules can change anytime, and if you keep playing here, you agree to whatever new rules we make up.' Pretty sneaky, right?",
    analogy:"Imagine your friend owns a toy and says 'you can play with it but I can change the rules anytime.' If you keep playing, you're saying the new rules are okay!",
    vocab:[{word:"Provision",def:"A rule or part of an agreement ‚Äî like one rule in a big list of rules"},{word:"Discretion",def:"When someone gets to decide all by themselves, without asking anyone else"},{word:"Consent",def:"Saying 'yes, I agree' ‚Äî like nodding your head to show you're okay with something"}],
    origComplexity:92,simpReadability:95
  },
  tech:{
    explanation:"Okay! üíª So the internet is like a HUGE postal system for computers! When you want to visit a website, your computer sends a tiny letter (called a 'packet') to another computer far away. That computer sends back lots of little letters with the website info. TCP/IP is just the set of rules for HOW these letters get sent ‚Äî like how we write an address on an envelope so it goes to the right house!",
    analogy:"Think of the internet like passing notes in class, but the notes can travel all around the world in less than a second!",
    vocab:[{word:"Protocol",def:"A set of rules everyone agrees to follow ‚Äî like how we all agree to drive on the same side of the road"},{word:"TCP/IP",def:"The 'language' computers use to talk to each other over the internet"},{word:"Packet",def:"A tiny chunk of information, like one page torn out of a big book, sent separately"}],
    origComplexity:85,simpReadability:97
  },
  medical:{
    explanation:"Okay so! üíä When you take medicine, your body has to figure out where to send it and what to do with it. Pharmacokinetics is just a big fancy word for tracking where the medicine goes in your body! First your tummy absorbs it (like a sponge drinking water), then it travels in your blood to where it's needed, does its job, and then your body slowly cleans it out. Doctors need to know how fast this happens so they know how much medicine to give you and when!",
    analogy:"It's like a little medicine bus journey inside your body ‚Äî it gets on at your stomach, travels through blood highways, stops where it's needed, then gets dropped off at the exit!",
    vocab:[{word:"Absorption",def:"How medicine gets into your blood ‚Äî like how a sponge soaks up water"},{word:"Metabolism",def:"Your body breaking things down ‚Äî like how it uses food for energy"},{word:"Dosage",def:"How much medicine to take ‚Äî too little won't help, too much could hurt"}],
    origComplexity:90,simpReadability:96
  },
  finance:{
    explanation:"Okay! üí∞ You know how if you put money in a piggy bank, it just stays the same? Compound interest is WAY cooler! Say you put ¬£100 in a bank. Next year they give you ¬£10 extra for keeping it there. Now you have ¬£110. THEN next year they give you 10% of ¬£110 ‚Äî that's ¬£11! Each year the bonus gets bigger because you're earning bonus ON your bonus! Over many years, your money keeps growing faster and faster like a snowball rolling down a hill!",
    analogy:"It's like magic beans! You plant one, get two. Plant both, get four. Keep planting everything and soon you have a giant beanstalk!",
    vocab:[{word:"Interest",def:"Extra money a bank pays you for letting them keep your money safe"},{word:"Principal",def:"The original money you put in ‚Äî before any extras"},{word:"Compound",def:"Adding things on top of things ‚Äî like interest on top of interest"}],
    origComplexity:72,simpReadability:98
  },
  any:{
    explanation:"Okay! üåç So our planet Earth has a big warm blanket of air around it ‚Äî that's our atmosphere. Normally it keeps just enough warmth in, like a cosy duvet. But because of cars, factories, and burning things, we're adding extra layers to that blanket! Now it's getting TOO warm. This makes ice melt, seas rise, and weather go a bit crazy ‚Äî more big storms, more hot days, more floods. Scientists call the stuff that makes the blanket thicker 'greenhouse gases' because it's like a greenhouse that traps warmth inside.",
    analogy:"Imagine wearing 10 jumpers inside a warm house. You'd get way too hot! That's basically what we're doing to Earth.",
    vocab:[{word:"Atmosphere",def:"The big blanket of air surrounding Earth that keeps us alive and warm"},{word:"Greenhouse gas",def:"Gases like CO‚ÇÇ that trap heat ‚Äî like an extra layer on Earth's blanket"},{word:"Climate",def:"The usual weather patterns of a place over a long, long time"}],
    origComplexity:80,simpReadability:95
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setMode(mode, btn){
  selectedMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadExamples();
  simplifyLevel = 1;
}

function setAge(age, btn){
  selectedAge = age;
  document.querySelectorAll('.age-pill').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

function loadExamples(){
  const exs = EXAMPLES[selectedMode] || EXAMPLES.any;
  document.getElementById('examples').innerHTML =
    '<span style="font-size:12px;font-weight:700;color:var(--muted);align-self:center">Try:</span>' +
    exs.map(e=>`<button class="ex-btn" onclick="loadExample(${JSON.stringify(e.text).replace(/'/g,"\\'")})">${e.label}</button>`).join('');
}

function loadExample(text){
  document.getElementById('text-input').value = text;
  updateCharCount();
  document.getElementById('text-input').focus();
}

function updateCharCount(){
  const len = document.getElementById('text-input').value.length;
  document.getElementById('char-count').textContent = len + ' / 2000';
}

function checkApiKey(){
  const key = document.getElementById('api-input').value.trim();
  const status = document.getElementById('api-status');
  if(key.startsWith('sk-ant')||key.startsWith('sk-')){
    status.textContent = '‚óè Key set!';status.className='set';
  } else {
    status.textContent = '‚óè Not set';status.className='empty';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN SIMPLIFY FUNCTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function simplify(){
  const text = document.getElementById('text-input').value.trim();
  if(!text){ shake('text-input'); return; }

  const apiKey = document.getElementById('api-input').value.trim();
  const hasKey = apiKey.startsWith('sk-');

  document.getElementById('gen-btn').disabled = true;
  document.getElementById('btn-text').textContent = 'Thinking‚Ä¶';
  document.getElementById('output').classList.remove('show');
  document.getElementById('loading').classList.add('show');

  // Animate kid emoji
  const kids = ['ü§î','üí≠','üòÆ','üßê','üí°','üéâ'];
  let ki=0; const kiv = setInterval(()=>{ document.getElementById('loading-kid').textContent=kids[ki++%kids.length]; },400);

  try{
    let result;
    if(hasKey){
      result = await callClaudeAPI(apiKey, text, selectedMode, selectedAge, simplifyLevel);
    } else {
      // Demo mode ‚Äî use pre-written responses
      await sleep(2200);
      result = getDemoResponse(text, selectedMode);
    }

    clearInterval(kiv);
    showOutput(result, text);
    addToHistory(text, result);

  } catch(err){
    clearInterval(kiv);
    document.getElementById('loading').classList.remove('show');
    showError(err.message || 'Something went wrong. Try Demo Mode!');
  }

  document.getElementById('gen-btn').disabled = false;
  document.getElementById('btn-text').textContent = 'Make It Simple!';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLAUDE API CALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function callClaudeAPI(apiKey, text, mode, age, level){
  const ageDesc = age === 'teenager' ? 'a 14-year-old teenager' : age === 'grandparent' ? 'a grandparent with no technical background' : `a ${age}-year-old child`;
  const levelExtra = level > 1 ? ` Make it EVEN simpler than before ‚Äî use shorter sentences and more basic words.` : '';

  const prompt = `You are a friendly, enthusiastic teacher who LOVES making complicated things simple.

Task: Rewrite the following ${mode} text so that ${ageDesc} can fully understand it.${levelExtra}

Rules:
- Use very simple everyday words
- Use fun analogies and comparisons to familiar things
- Keep sentences short
- Add relevant emojis naturally
- Sound warm, excited, and encouraging
- Start with "Okay so!" or "Alright!" to set a friendly tone

IMPORTANT: Reply ONLY with valid JSON in this exact format (no markdown, no backticks):
{
  "explanation": "your simplified explanation here",
  "analogy": "one fun real-world analogy that makes this click",
  "vocab": [
    {"word": "BigWord1", "def": "simple definition"},
    {"word": "BigWord2", "def": "simple definition"},
    {"word": "BigWord3", "def": "simple definition"}
  ],
  "origComplexity": 85,
  "simpReadability": 96
}

Text to simplify:
"""
${text}
"""`;

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': apiKey,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1024,
      messages: [{ role: 'user', content: prompt }]
    })
  });

  if(!response.ok){
    const err = await response.json();
    throw new Error(err.error?.message || `API Error ${response.status}`);
  }

  const data = await response.json();
  const raw = data.content[0].text.trim();
  // Strip markdown if present
  const cleaned = raw.replace(/```json|```/g,'').trim();
  return JSON.parse(cleaned);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DEMO RESPONSE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getDemoResponse(text, mode){
  const base = DEMO_RESPONSES[mode] || DEMO_RESPONSES.any;
  return {
    explanation: base.explanation,
    analogy: base.analogy,
    vocab: base.vocab,
    origComplexity: base.origComplexity,
    simpReadability: base.simpReadability
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHOW OUTPUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showOutput(result, originalText){
  document.getElementById('loading').classList.remove('show');

  // Main explanation
  lastOutput = result.explanation;
  document.getElementById('output-text').innerHTML = formatExplanation(result.explanation);

  // Badge
  const ageLabels = {5:'ELI5 ‚Äî Age 5',8:'ELI8 ‚Äî Age 8',12:'ELI12 ‚Äî Age 12',teenager:'ELI-Teen',grandparent:'ELI-Grandparent'};
  document.getElementById('output-badge').textContent = ageLabels[selectedAge] || 'ELI5';

  // Analogy
  if(result.analogy){
    document.getElementById('analogy-text').textContent = result.analogy;
    document.getElementById('analogy-box').classList.add('show');
  }

  // Vocab
  if(result.vocab && result.vocab.length){
    document.getElementById('vocab-list').innerHTML = result.vocab.map(v=>`
      <div class="vocab-item">
        <span class="vocab-word">üìñ ${v.word}</span>
        <span class="vocab-def">${v.def}</span>
      </div>`).join('');
    document.getElementById('vocab-box').classList.add('show');
  }

  // Complexity meters
  const orig = result.origComplexity || estimateComplexity(originalText);
  const simp = result.simpReadability || 96;
  setTimeout(()=>{
    document.getElementById('orig-fill').style.width = orig + '%';
    document.getElementById('simp-fill').style.width = simp + '%';
    document.getElementById('orig-val').textContent = orig + '% complex';
    document.getElementById('simp-val').textContent = simp + '% readable';
  }, 300);

  document.getElementById('output').classList.add('show');
  document.getElementById('output').scrollIntoView({behavior:'smooth', block:'start'});
}

function formatExplanation(text){
  // Wrap key phrases in highlight spans for visual interest
  return text.replace(/["""](.*?)["""]/g, '<span class="highlight">$1</span>');
}

function estimateComplexity(text){
  const words = text.split(/\s+/).length;
  const longWords = text.split(/\s+/).filter(w=>w.length>8).length;
  return Math.min(98, Math.round(40 + (longWords/words)*100*0.6 + Math.min(30, words/10)));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function copyOutput(){
  const text = document.getElementById('output-text').innerText + '\n\n' +
    (document.getElementById('analogy-box').classList.contains('show') ?
     'Analogy: ' + document.getElementById('analogy-text').textContent : '');
  navigator.clipboard.writeText(text).then(()=>{
    const btn = event.target.closest('.action-btn');
    const orig = btn.innerHTML;
    btn.innerHTML = '‚úÖ Copied!';
    setTimeout(()=>btn.innerHTML=orig, 2000);
  });
}

function readAloud(){
  const text = document.getElementById('output-text').innerText;
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel();
    const utt = new SpeechSynthesisUtterance(text);
    utt.rate = 0.9; utt.pitch = 1.1;
    window.speechSynthesis.speak(utt);
    const btn = event.target.closest('.action-btn');
    btn.innerHTML = 'üîä Speaking‚Ä¶';
    utt.onend = ()=>{ btn.innerHTML = 'üîä Read Aloud'; };
  }
}

async function simplifyMore(){
  simplifyLevel++;
  await simplify();
}

function resetAll(){
  document.getElementById('output').classList.remove('show');
  document.getElementById('text-input').value = '';
  updateCharCount();
  simplifyLevel = 1;
  window.scrollTo({top:0, behavior:'smooth'});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addToHistory(originalText, result){
  const item = {
    topic: originalText.substring(0,60) + (originalText.length > 60 ? '‚Ä¶' : ''),
    preview: result.explanation.substring(0,120) + '‚Ä¶',
    mode: selectedMode,
    age: selectedAge,
    full: result
  };
  history.unshift(item);
  if(history.length > 5) history.pop();
  renderHistory();
}

function renderHistory(){
  if(history.length === 0) return;
  const section = document.getElementById('history-section');
  section.classList.add('show');
  const modeColors = {science:'#4ecdc4',legal:'#ff6b35',tech:'#a855f7',medical:'#ff6b9d',finance:'#06d6a0',any:'#ffd93d'};
  document.getElementById('history-list').innerHTML = history.map((item,i)=>`
    <div class="history-item" onclick="reloadHistory(${i})">
      <div class="hist-topic">${item.topic}</div>
      <div class="hist-preview">${item.preview}</div>
      <div class="hist-meta">
        <span class="hist-tag" style="background:${modeColors[item.mode]}22;color:${modeColors[item.mode]};border:1px solid ${modeColors[item.mode]}44">${item.mode}</span>
        <span class="hist-tag" style="background:rgba(255,217,61,.15);color:#b8860b;border:1px solid rgba(255,217,61,.3)">Age ${item.age}</span>
      </div>
    </div>`).join('');
}

function reloadHistory(i){
  showOutput(history[i].full, history[i].topic);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

function shake(id){
  const el = document.getElementById(id);
  el.style.animation = 'none';
  el.style.borderColor = 'var(--orange)';
  setTimeout(()=>el.style.borderColor='', 1000);
}

function showError(msg){
  document.getElementById('loading').classList.remove('show');
  const out = document.getElementById('output');
  out.innerHTML = `<div id="output-card" style="border-color:var(--pink);box-shadow:6px 6px 0 rgba(255,107,157,.2)">
    <div id="output-header" style="background:linear-gradient(135deg,#fff0f4,#ffe4ec)">
      <div class="output-title"><span>üòï</span><span>Oops! Something went wrong</span></div>
    </div>
    <div id="output-body">
      <p style="color:var(--ink);font-size:15px;line-height:1.7;font-weight:600">${msg}</p>
      <p style="margin-top:12px;font-size:14px;color:var(--muted)">üí° Try using <strong>Demo Mode</strong> ‚Äî just click the button without an API key to see how it works!</p>
    </div>
  </div>`;
  out.classList.add('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load', ()=>{
  loadExamples();
  // Auto-load first science example
  setTimeout(()=>{
    if(!document.getElementById('text-input').value){
      document.getElementById('text-input').value = EXAMPLES.science[0].text;
      updateCharCount();
    }
  }, 500);
});
</script>
</body>
</html>
